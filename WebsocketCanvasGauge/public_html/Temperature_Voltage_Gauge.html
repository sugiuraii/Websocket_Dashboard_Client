<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>WaterTemp/Batt Voltage</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="./script/libs/jquery/jquery.js"></script>
        <script src="./script/websocket/SSMCOM_WSTest.js"></script>
        <script>
            var ssm_ws = new SSMCOM_Websocket();
            ssm_ws.onVALpacketReceived = function(val)
            {
                for (var key in val)
                {
                    if(key === "Coolant_Temperature")
                    {
                        $("#gauge_frame1")[0].contentWindow.value = val[key];
                        $("#gauge_frame1")[0].contentWindow.value_update();
                    }
                    else if (key === "Battery_Voltage")
                    {
                        $("#gauge_frame2")[0].contentWindow.value = val[key];
                        $("#gauge_frame2")[0].contentWindow.value_update();
                    }
                }
            };
            ssm_ws.onERRpacketReceived = function(msg)
            {
                $('#div_message').append(msg + "<br>");
            };
            ssm_ws.onRESpacketReceived = function(msg)
            {
                $('#div_message').append(msg + "<br>");
            };
            ssm_ws.onWebsocketError = function(msg)
            {
                $('#div_message').append(msg + "<br>");
            };
            ssm_ws.onWebsocketOpen = function()
            {
                $('#div_message').append('* Connection started<br/>');
                setTimeout(
                function(){
                //ssm_ws.SendSSMCOMRead("Coolant_Temperature","FAST","true");
                //ssm_ws.SendSSMCOMRead("Battery_Voltage","FAST","true");
                ssm_ws.SendSSMCOMRead("Coolant_Temperature","SLOW","true");
                ssm_ws.SendSSMCOMRead("Battery_Voltage","SLOW","true");
                },5000);
            };
            ssm_ws.onWebsocketClose = function()
            {
                $('#div_message').append('* Connection closed<br/>');
            };
            initialize_gauge1 = function()
            {
                var gauge_id = "#gauge_frame1";
                $(gauge_id)[0].contentWindow.value_max = 150;
                $(gauge_id)[0].contentWindow.value_min = 50;
                $(gauge_id)[0].contentWindow.title_str = "WATER TEMP";
                $(gauge_id)[0].contentWindow.unit_str = "C";
                $(gauge_id)[0].contentWindow.scale_str1 ="50";
                $(gauge_id)[0].contentWindow.scale_str2 ="75";
                $(gauge_id)[0].contentWindow.scale_str3 = "100";
                $(gauge_id)[0].contentWindow.scale_str4 = "125";
                $(gauge_id)[0].contentWindow.scale_str5 = "150";
                $(gauge_id)[0].contentWindow.redzone_offset_angle = 292.5;
                $(gauge_id)[0].contentWindow.redzone_full_angle = 67.5;
                $(gauge_id)[0].contentWindow.value_label_rounded = 0;
                $(gauge_id)[0].contentWindow.initialize();
            };
            
            initialize_gauge2 = function()
            {
                var gauge_id = "#gauge_frame2";
                $(gauge_id)[0].contentWindow.value_max = 15;
                $(gauge_id)[0].contentWindow.value_min = 11;
                $(gauge_id)[0].contentWindow.title_str = "BATTERY VOLT";
                $(gauge_id)[0].contentWindow.unit_str = "V";
                $(gauge_id)[0].contentWindow.scale_str1 ="11";
                $(gauge_id)[0].contentWindow.scale_str2 ="12";
                $(gauge_id)[0].contentWindow.scale_str3 = "13";
                $(gauge_id)[0].contentWindow.scale_str4 = "14";
                $(gauge_id)[0].contentWindow.scale_str5 = "15";
                $(gauge_id)[0].contentWindow.redzone_offset_angle = 337.5;
                $(gauge_id)[0].contentWindow.redzone_full_angle = 22.5;
                $(gauge_id)[0].contentWindow.value_label_rounded = 1;
                $(gauge_id)[0].contentWindow.initialize();
            };
            
            
            function onTestClick()
            {
                $("#gauge_frame1")[0].contentWindow.value = 75;
                $("#gauge_frame1")[0].contentWindow.value_update();
                $("#gauge_frame2")[0].contentWindow.value = 11.2;
                $("#gauge_frame2")[0].contentWindow.value_update();
            };
            
            function connectWebSocket()
            {
                ssm_ws.URL = "ws://"+location.hostname+":2013/";
                ssm_ws.Connect();
            };
            
            onload = function()
            {
                initialize_gauge1();
                initialize_gauge2();
                connectWebSocket();
            };
            
        </script>
        <style>
            iframe.meter {
                    position:absolute;
                    border: none;
                    -webkit-transform:scale(0.4,0.4);
                    -moz-transform:scale(0.4,0.4);
                    -ms-transform:scale(0.4,0.4);
                    transform:scale(0.4,0.4);
                    -webkit-transform-origin: 0 0;
                    -moz-transform-origin: 0 0;
                    -ms-transform-origin: 0 0;
                    transform-origin: 0 0;
                }
        </style>
    </head>
    <body>
    
    <iframe class="meter" style="top:10px" id="gauge_frame1" src="./parts/SemiCircularGauge/SemiCircularGauge.html" scrolling="no" width="799" height="584" seamless> </iframe>
    <iframe class="meter" style="top:240px" id="gauge_frame2" src="./parts/SemiCircularGauge/SemiCircularGauge.html" scrolling="no" width="799" height="584" seamless> </iframe>
    <div id="div_message" style="position:absolute;top:500px"></div>
    </body>
</html>
