<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <script src="../../script/canvas_progressbar/CircularProgressBar_canvas.js"></script>
        <script src="../../script/canvas_progressbar/NeedleGauge_canvas.js"></script>
        <script src="../../script/libs/jquery/jquery.js"></script>
        <style>
            @font-face {
            font-family: 'AstronautII';
            font-style: normal;
            src: url(../../Fonts/Astronaut2.ttf) format('truetype');
            }
            div.meter{
                position:relative;
            }
            div.LCD_Text
            {
                position:absolute;
                color: black;
                font-family:'AstronautII';
                width:200px;
            }
        </style>
        <script>
            var _tacho_bar;
            var _tacho_needle;
            var _speed_needle;
            var _watertemp_bar;
            var _boost_needle;
            
            this.tacho = 0;
            this.speed = 0;
            this.watertemp = 0;
            this.trip = 0.0;
            this.fuel = 0.00;
            this.gas_milage = 0.00;
            this.boost = -1.0;
            this.neutral_sw = false;
            
            function initialize()
            {
                _tacho_bar = circularprogressbar_initialize("tacho_bar","AnalogTachoMeter_Bar.png",0, 9000, 90, 270,false,value_update);
                _watertemp_bar = circularprogressbar_initialize("watertemp_bar","AnalogSpeedMeter_Bar.png",60,140,165,120,false,value_update);
                _tacho_needle = needlegauge_initialize("tacho_needle","AnalogTachoMeter_Needle.png",0,9000,90,270,false,value_update);
                _speed_needle = needlegauge_initialize("speed_needle","AnalogSpeedMeter_Needle.png",0,280,75,210,false,value_update);
                _boost_needle = needlegauge_initialize("boost_needle","BoostMeter_Needle.png",-1.0,2.0,30,90,true,value_update);
            }
            
            function circularprogressbar_initialize(canvas_id, canvas_img_name, value_min, value_max, offset_angle, full_angle, anticlockwise, onload_action)
            {
                var canvas_elem = document.getElementById(canvas_id);
                var image_elem = new Image();
                image_elem.src = canvas_img_name;
                
                var canvas_obj = new CircularProgressBar_canvas(canvas_elem,image_elem);
                canvas_obj.offset_angle = offset_angle;
                canvas_obj.full_angle = full_angle;
                canvas_obj.anticlockwise = anticlockwise;
                canvas_obj.min = value_min;
                canvas_obj.max = value_max;
                canvas_obj.onload = onload_action;
                
                return canvas_obj;
            }
            
            function needlegauge_initialize(canvas_id, canvas_img_name, value_min, value_max, offset_angle, full_angle, anticlockwise, onload_action)
            {
                var canvas_elem = document.getElementById(canvas_id);
                var image_elem = new Image();
                image_elem.src = canvas_img_name;
                
                var canvas_obj = new NeedleGauge_canvas(canvas_elem,image_elem);
                canvas_obj.offset_angle = offset_angle;
                canvas_obj.full_angle = full_angle;
                canvas_obj.anticlockwise = anticlockwise;
                canvas_obj.min = value_min;
                canvas_obj.max = value_max;
                canvas_obj.onload = onload_action;
                
                return canvas_obj;
            }
            
            function calc_gear_pos(tacho, speed, neutral_sw)
            {
                if (neutral_sw)
                    return "N";

                //0除算防止（車両停止時）
                if (speed <= 0)
                    return "-";

                var gear_ratio = 1 / 3.9 * tacho * 60 * 0.001992 / speed;

                if (gear_ratio > 4.27)
                    return "-";
                else if (gear_ratio > 3.01)
                    return 1;
                else if (gear_ratio > 2.07)
                    return 2;
                else if (gear_ratio > 1.55)
                    return 3;
                else if (gear_ratio > 1.2)
                    return 4;
                else if (gear_ratio > 0.95)
                    return 5;
                else if (gear_ratio > 0.73)
                    return 6;
                else
                    return "-";  
            };
            
            value_update = function()
            {
                _tacho_bar.value = tacho;
                _tacho_needle.value = tacho;
                _speed_needle.value = speed;
                _watertemp_bar.value = watertemp;
                _boost_needle.value = boost;

                _tacho_bar.draw();
                _tacho_needle.draw();
                _speed_needle.draw();
                _watertemp_bar.draw();
                _boost_needle.draw();
                
                if(parseFloat(this.fuel).toFixed(2) !== $("#fuel_label").text())
                    $("#fuel_label").text(parseFloat(this.fuel).toFixed(2));
                if(parseFloat(this.trip).toFixed(1) !== $("#trip_label").text())
                    $("#trip_label").text(parseFloat(this.trip).toFixed(1));
                if(parseFloat(this.gas_milage).toFixed(2) !== $("#gas_milage_label").text())
                    $("#gas_milage_label").text(parseFloat(this.gas_milage).toFixed(2));
                if(parseFloat(this.speed).toFixed(0) !== $("#speed_label").text())
                    $("#speed_label").text(parseFloat(this.speed).toFixed(0));
                if(calc_gear_pos(tacho, speed, neutral_sw) !== $("#gearpos_label").text())
                    $("#gearpos_label").text(calc_gear_pos(tacho, speed, neutral_sw));   
            };
            
            onload = function() {
                //initialize();
            };
    </script>
    </head>
    <body>
        <div id="tachometer" style="position:absolute;top:0px;left:345px;z-index:1">          
            <img src="AnalogTachoMeter_Base.png" width="600" height="600" alt="" style="position:absolute;z-index:0">
            <canvas id="tacho_bar" width="600" height="600" style="position:absolute;z-index:1;"></canvas>
            <canvas id="tacho_needle" width="600" height="600" style="position:absolute;z-index:2;"></canvas>
            <img src="AnalogTachoMeter_NeedleCap.png" width="600" height="600" alt="" style="position:absolute;z-index:3">
            <div id="gas_milage_label" class="LCD_Text" style="top:300px;left:285px;text-align: right;font-size:56px;z-index:1">0.00</div>
            <div id="trip_label" class="LCD_Text" style="top:353px;left:300px;text-align: right;font-size:48px;z-index:1">0.0</div>
            <div id="fuel_label" class="LCD_Text" style="top:388px;left:300px;text-align: right;font-size:48px;z-index:1">0.00</div>
            <div id="gearpos_label" class="LCD_Text" style="top:408px;left:190px;text-align: right;font-size:160px;z-index:1">N</div>
        </div>
        <div id="speedmeter" style="position:absolute;top:0px;left:0px;z-index:0">          
            <img src="AnalogSpeedMeter_Base.png" width="600" height="600" alt="" style="position:absolute;z-index:0">
            <canvas id="watertemp_bar" width="600" height="600" style="position:absolute;z-index:1;"></canvas>
            <canvas id="speed_needle" width="600" height="600" style="position:absolute;z-index:2;"></canvas>
            <img src="AnalogSpeedMeter_NeedleCap.png" width="600" height="600" alt="" style="position:absolute;z-index:3">
            <div id="speed_label" class="LCD_Text" style="top:355px;left:150px;text-align: right;font-size:85px;z-index:1">0</div>

        </div>
        <div id="boostmeter" style="position:absolute;top:80px;left:615px;z-index:0">          
            <img src="BoostMeter_Base.png" width="441" height="441" alt="" style="position:absolute;z-index:0">
            <canvas id="boost_needle" width="441" height="441" style="position:absolute;z-index:1;"></canvas>
        </div>

    </body>
</html>

